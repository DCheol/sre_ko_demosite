<!DOCTYPE html> 
<html>
    <textarea id='inputmml' value='test용' class="text"></textarea>
    <button id="button" type="button" onclick='change()'>바꾸기</button>
    <br>
    <textarea id='outputmml' class="text"></textarea>
    <br>
    <p>수식</p>
    <p id='output_mathjax' aria-label></p>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script src="https://cdn.jsdelivr.net/jquery/1.12.4/jquery.min.js"></script>
        <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
        <title>Korea Mathspeak Tensor tests.</title>
        <script async>
            var SREfeature = {
            "custom": function(loc) {
                //for Vscode Live Server
                //let file = 'http://localhost:5500/lib/mathmaps/' + loc + '.json';
                let file = 'https://dcheol.github.io/sre_ko_demosite/lib/mathmaps/' + loc + '.json';
                let httpRequest = new XMLHttpRequest();
                return new Promise((res, rej) => {
                  httpRequest.onreadystatechange = function() {
                    if (httpRequest.readyState === 4) {
                      console.log('Using my custom loader');
                      let status = httpRequest.status;
                      if (status === 0 || (status >= 200 && status < 400)) {
                        res(httpRequest.responseText);
                        console.log('resolve');
                      } else {
                        rej(status);
                        console.log('reject');
                      }
                    }
                  };
                  httpRequest.open('GET', file, true);
                  httpRequest.send();
                });
              }
            }
        </script>
        <script src='./lib/sre.js' async></script>
        <script>
          var input = document.getElementById('inputmml')       //input text area
          var output = document.getElementById('output_mathjax'); //output mathjax
          var button = document.getElementById('button');

          const change = function(){
              var dom = $('input[name="DOMAIN"]:checked').val();
              var loc = $('input[name="LOCALE"]:checked').val();
              
              SRE.setupEngine({
                'domain' : dom,
                'locale': loc
              });
              
              //setting output textarea
              const mml = SRE.toSpeech(input.value);
              document.getElementById('outputmml').value = mml; //outnput text area
              
              button.disabled = true;
              output.innerHTML = input.value.trim();
              // MathJax.texReset();
              // MathJax.typesetClear();
              MathJax.typesetPromise([output]).catch(function(err) {
                output.innerHTML = '';
                output.appendChild(document.createTextNode(err.message));
                console.error(err);
              }).then(function() {
                button.disabled = false;
                // input.value = "";
              });
              // document.getElementById('output_mathjax').innerHTML = inputtext;
              
              document.getElementById('output_mathjax').setAttribute('aria-label', mml);
              // <math><mo>-</mo><mo>(</mo><mn>31</mn><mo>.</mo><mn>65</mn><msup><mo>)</mo><mn>5</mn></msup></math>
          }
        </script>

        <style>
          /* .text { color: teal; } */
          textarea {
            width: 60%;
            height: 200px;
          }

        </style>
        
        
    </head>

    <body>
        <!-- <textarea id='inputmml' value='test용' class="text"></textarea>
        <button id="Rendering" type="button" onclick='change()'>바꾸기</button>
        <br>
        <textarea id='outputmml' class="text"></textarea>
        <br>
        <p id='output_mathjax' aria-label>
          
        </p> -->
        <!-- <math id='output_mathjax' aria-label ><mo>-</mo><mo>(</mo><mn>31</mn><mo>.</mo><mn>65</mn><msup><mo>)</mo><mn>5</mn></msup></math> -->
        <br>
        <input type="radio" value='mathspeak' name="DOMAIN" checked="checked">Mathspeak
        <input type="radio" value='clearspeak' name="DOMAIN">ClearSpeak
        <br>
        <input type="radio" value='en' name="LOCALE" checked="checked">en
        <input type="radio" value='ko' name="LOCALE">ko

        
        
        

    </body>
</html>
